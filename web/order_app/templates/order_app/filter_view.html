{% extends 'base.html' %}
{% load render_table from django_tables2 %}
{% load bootstrap3 %}
{% load leaflet_tags %}

{% block content %}
   <div class="container col-md-12">
    <form action="" method="get" class="form-horizontal pull-left">
        {% for field in filter.form %}
            {% bootstrap_field field field_class='col-md-6' label_class='col-md-6'%}
        {% endfor %}

        {% buttons %}
            {% buttons submit='Найти' layout='horizontal'%}{% endbuttons %}
        {% endbuttons %}
    </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/bootstrap-select.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/css/bootstrap-select.min.css" />


    <script type="text/javascript">
        $('.selectpicker').selectpicker({
          });
    </script>

    <br>
    <hr>

    {% leaflet_js %}
    {% leaflet_css %}

    {% leaflet_map "main" %}


    <script type="text/javascript">
        window.addEventListener("map:init", function (e) {
            var map = e.detail.map;

            var greenIcon = new L.Icon({
              iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
              shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
            });

            var redIcon = new L.Icon({
              iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
              shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
            });

            {% for order in order_list %}
                var marker = L.marker(
                    [{{ order.latitude|stringformat:"f" }}, {{ order.longitude|stringformat:"f"}}],
                    {% if order.status == 'CM' %}
                        {icon: greenIcon}
                    {% else %}
                        {icon: redIcon}
                    {% endif %}
                )
                marker.addTo(map).bindPopup('{{ order.popup|safe }}');
            {% endfor %}




        }, false);
    </script>

    <hr>
    <div class="container col-md-12">
        {% render_table table %}
    </div>

{% endblock %}