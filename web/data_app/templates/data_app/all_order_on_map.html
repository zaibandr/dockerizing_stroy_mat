{% extends 'base.html' %}
{% load static %}
{% load leaflet_tags %}


{% block content %}

    {% leaflet_js %}
    {% leaflet_css %}

    {% leaflet_map "main" %}


    <script type="text/javascript">
        window.addEventListener("map:init", function (e) {
            var map = e.detail.map;

            var greenIcon = new L.Icon({
              iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
              shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
            });

            var redIcon = new L.Icon({
              iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
              shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
            });

            {% for o in all_order %}
                var marker = L.marker(
                    [{{ o.latitude|stringformat:"f" }}, {{ o.longitude|stringformat:"f"}}],
                    {% if o.status == 'CMPLTD' %}
                        {icon: greenIcon}
                    {% else %}
                        {icon: redIcon}
                    {% endif %}

                    ).addTo(map);
                marker.bindPopup('<a href="/order/detail/'+'{{ o.pk }}'+'/" title="Перейти на станицу заказа">'+'{{ o.address }}'+'</a><hr>'+
                    '{{ o.product.name }} - '+'{{ o.provider.name }}<hr>'+
                    'Объем: {{ o.volume }} - '+'{{ o.cost }}р');
            {% endfor %}

        }, false);
    </script>

{% endblock %}